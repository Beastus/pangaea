<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pangaea Demo</title>
  <link href="css/style.css" rel="stylesheet">
  <link href="css/jquery-ui-1.10.3.custom.min.css" rel="stylesheet">
</head>
<body>

	<div class="content">

		<div id="message">
			Pangaea is a simple 2D tile renderer created as an experimental step toward a 2D game engine.
		</div>

		<div id="canvas_container">
		</div>

		<div id="options" style="display: none;">
			<fieldset id="flags">
				<legend></legend>
				<input type="checkbox" id="check1" /><label for="check1">enable_player</label>
				<input type="checkbox" id="check2" /><label for="check2">draw_fps</label>
				<input type="checkbox" id="check3" /><label for="check3">hit_testing</label>
				<input type="checkbox" id="check4" /><label for="check4">draw_hit_regions</label>
				<input type="checkbox" id="check5" /><label for="check5">log_key_input</label>
				<button id="buttonFullscreen">full_screen</button>
			</fieldset>
		</div>

	</div>

	<script src="js/jquery-1.9.1.js"></script>
	<script src="js/jquery-ui-1.10.3.custom.min.js"></script>
	<script src="js/jquery.cookie.js"></script>
	<script src="js/jscolor/jscolor.js"></script>

	<!-- Pangaea scripts -->
	<script src="../src/core.js"></script>
	<script src="../src/util.js"></script>
	<script src="../src/canvas.js"></script>
	<script src="../src/layer.js"></script>

	<script>
		$(document).ready(function () {
			"use strict";

			var onupdate, onrender, loadAllSettings, saveAllSettings, saveSetting, loadSetting;

			onupdate = function () {
				// optionally fired on frame update
			};

			onrender = function () {
				// optionally fired on frame render
			};

			// specify initial settings (cookie will override--see below)
			pan.settings.enable_player = true;

			// attach canvas
			pan.canvas.attach("canvas_container", onupdate, onrender);

			// start animation loop
			pan.canvas.start();

			// bind keyboard events
			pan.util.keyboard.bind();


			/*
			 * Options Panel
			 */

			// debug flags checkbox set
			$("#flags :checkbox").click(function () {
				var checkstate = $("#flags").find("input:checkbox");
				pan.settings.enable_player = checkstate[0].checked;
				pan.settings.draw_fps = checkstate[1].checked;
				pan.settings.enable_hit_testing = checkstate[2].checked;
				pan.settings.draw_hit_regions = checkstate[3].checked;
				pan.settings.log_key_input = checkstate[4].checked;

				// persist current settings
				saveAllSettings();
			});
			$("#flags").buttonset();

			// wire up fullscreen button
			$("#buttonFullscreen").button().click(function () {
				// make the canvas full screen
				var c = document.getElementById("canvas");
				if (c.requestFullScreen) {
					c.requestFullScreen();
				} else if (c.webkitRequestFullScreen) {
					// Element.ALLOW_KEYBOARD_INPUT is important--necessary for
					// W,A,S,D to function while in full screen mode.
					c.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
				} else if (c.mozRequestFullScreen) {
					c.mozRequestFullScreen();
				}
			});

			// fade in the page
			$("body").hide().fadeIn(800);
			window.setTimeout(function () {
				$("#options").fadeIn(600);
			}, 400);


			//
			// helper functions
			//

			loadAllSettings = function () {
				if (loadSetting("enable_player") !== undefined) {
					pan.settings.enable_player = loadSetting("enable_player") === "true";
					pan.settings.draw_fps = loadSetting("draw_fps") === "true";
					pan.settings.enable_hit_testing = loadSetting("enable_hit_testing") === "true";
					pan.settings.draw_hit_regions = loadSetting("draw_hit_regions") === "true";
					pan.settings.log_key_input = loadSetting("log_key_input") === "true";
				}

				// update form state
				var checkstate = $("#flags").find("input:checkbox");
				$(checkstate[0]).attr("checked", pan.settings.enable_player);
				$(checkstate[1]).attr("checked", pan.settings.draw_fps);
				$(checkstate[2]).attr("checked", pan.settings.enable_hit_testing);
				$(checkstate[3]).attr("checked", pan.settings.draw_hit_regions);
				$(checkstate[4]).attr("checked", pan.settings.log_key_input);
				$("#flags").buttonset("refresh");
			};

			saveAllSettings = function () {
				saveSetting("enable_player", pan.settings.enable_player);
				saveSetting("draw_fps", pan.settings.draw_fps);
				saveSetting("enable_hit_testing", pan.settings.enable_hit_testing);
				saveSetting("draw_hit_regions", pan.settings.draw_hit_regions);
				saveSetting("log_key_input", pan.settings.log_key_input);
			};

			saveSetting = function (key, value) {
				$.cookie(key, value, { expires: 7 });
			};

			loadSetting = function (key) {
				return $.cookie(key);
			};

			// load previously saved flag states
			loadAllSettings();
		});
	</script>
</body>
</html>