/*! pangaea 2014-05-25 */
var pan=pan||{};!function(){"use strict";pan.settings={debugInit:!0,enablePlayer:!1,drawFps:!1,fontColor:"cyan",fontStyle:'12px "Courier New", Courier, monospace',enableHitTesting:!1,drawHitRegions:!1,drawLights:!0,logKeyInput:!1,autoResize:!0,toString:function(){return"[debugInit:"+this.debugInit+",enablePlayer:"+this.enablePlayer+",drawFps:"+this.drawFps+",fontColor:"+this.fontColor+",fontStyle:"+this.fontStyle+",enableHitTesting:"+this.enableHitTesting+",drawHitRegions:"+this.drawHitRegions+",drawLights:"+this.drawLights+",logKeyInput:"+this.logKeyInput+",autoResize:"+this.autoResize+"]"}}}(),function(){"use strict";var a,b,c,d,e,f,g=pan.settings,h=(pan.canvas,0),i=["ms","moz","webkit","o"];for(a=0,b=i.length;b>a&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[i[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[a]+"CancelAnimationFrame"]||window[i[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){return c=(new Date).getTime(),d=Math.max(0,16-(c-h)),e=window.setTimeout(function(){a(c+d)},d),h=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),g.autoResize&&(f=function(){var a=document.getElementById("canvas"),b=pan.canvas;document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen?(g.tempSize={w:b.width,h:b.height},b.width=screen.width,b.height=screen.height):g.tempSize&&(b.width=g.tempSize.w,b.height=g.tempSize.h),a.width=b.width,a.height=b.height},document.addEventListener("fullscreenchange",f),document.addEventListener("mozfullscreenchange",f),document.addEventListener("webkitfullscreenchange",f))}(),function(){"use strict";pan.Layer=function(a,b,c,d,e,f,g,h){var i=pan.canvas.map;this.data=a||[],this.name=b,this.type=c,this.left=d||0,this.top=e||0,this.width=f||i.width,this.height=g||i.height,this.coords=[],this.objects=h||[]},pan.Layer.prototype.update=function(){},pan.Layer.prototype.render=function(){},pan.Layer.prototype.prerender=function(){var a,b,c,d,e,f,g,h,i,j,k=pan.canvas,l=k.map,m=k.tilesets,n=k.atlases,o=k.table;if("tilelayer"===this.type){for(a=0,d=this.data.length;d>a;a++)if(e=this.data[a],0!==e){for(b=m.length;b>=0;b)b--,m[b].firstgid<=e&&(f=m[b],b=-1);for(c=0;c<n.length&&(g=n[c],h=c,!(i=this.selectFrame(g,f.image)));c++);this.computeFrame(l,i,a,f,e),pan.canvas.table||(j=Math.ceil(this.width/l.tilewidth*(this.height/l.tileheight)),o=pan.canvas.table=[j]),o[e]={aindex:0,srcx:i.srcx,srcy:i.srcy,w:f.tilewidth,h:f.tileheight}}}else if("lights"===this.name)for(this.type="lights",a=0;a<this.objects.length;a++)i=this.objects[a],i.ellipse&&i.visible&&k.lights.push({x:i.x,y:i.y,w:i.width,h:i.height});else if("hittest"===this.name)for(this.type="hittest",a=0;a<this.objects.length;a++)i=this.objects[a],i.visible&&k.hitRegions.push({x:i.x,y:i.y,w:i.width,h:i.height})},pan.Layer.prototype.computeFrame=function(a,b,c,d,e){var f,g,h,i;b.srcx=0,b.srcy=0,h=e-d.firstgid,i=b.frame.w/a.tilewidth,b.srcx=Math.round(h/i%1*i)*a.tilewidth,b.srcx=b.srcx+b.frame.x,b.srcy=Math.floor(h/i)*a.tileheight,b.srcy=b.srcy+b.frame.y,f=Math.round(c/a.width%1*a.width*a.tilewidth),g=Math.floor(c/a.width)*a.tileheight,this.coords[c]={xpos:f,ypos:g}},pan.Layer.prototype.selectFrame=function(a,b){var c,d,e=a.frames;for(c=0,d=e.length;d>c;c++)if(e[c].filename===b)return e[c];return null}}(),function(){"use strict";pan.loadAtlas=function(a){var b,c,d,e;if(!a)throw{name:"paramError",message:"Required parameter not supplied."};return b=a.meta.image,c="assets/"+b,d=new Image,d.src=c,e=new pan.Atlas(d,b,a.meta.size,a.frames)},pan.loadAtlasAsync=function(a,b){if(!a||!b)throw{name:"paramError",message:"Required parameter not supplied."};var c,d=a.meta.image,e="assets/"+d,f=a.meta.size,g=a.frames;c=new Image,c.onload=function(){var a=new pan.Atlas(c,d,f,g);b&&b(a)},c.src=e},pan.Atlas=function(a,b,c,d){this.image=a,this.name=b,this.size=c,this.frames=d},pan.Atlas.prototype.update=function(){},pan.Atlas.prototype.draw=function(){}}(),function(){"use strict";pan.loadSpriteSheet=function(a,b){var c,d;if(!b)throw{name:"paramError",message:"Required parameter not supplied."};return c=new Image,c.src=b,d=new pan.SpriteSheet(c,a)},pan.loadSpriteSheetAsync=function(a,b,c){if(!b||!c)throw{name:"paramError",message:"Required parameter not supplied."};var d=a||b,e=new Image;e.onload=function(){var a=new pan.SpriteSheet(e,d);c&&c(a)},e.src=b},pan.SpriteSheet=function(a,b){this.image=a,this.name=b}}(),function(){"use strict";pan.canvas={width:800,height:544,backcolor:"#000",context:null,atlases:[],spritesheets:[],layers:[],tilesets:[],lights:[],hitRegions:[],map:{tileheight:0,tilewidth:0,width:0,height:0,offsetx:0,offsety:0,clamp:{x:0,y:0,w:0,h:0}},frameId:null,onupdate:null,onrender:null,ready:!1,loadMap:function(a){var b,c,d=pan.canvas,e=d.map,f=e.clamp,g=d.layers;if(!a)throw{name:"paramError",message:"Required parameter not supplied."};for(e.tilewidth=a.tilewidth,e.tileheight=a.tileheight,e.width=a.width,e.height=a.height,f.x=d.width/2,f.y=d.height/2,f.w=e.width*e.tilewidth-e.clamp.x,f.h=e.height*e.tileheight-e.clamp.y,b=0,c=a.layers.length;c>b;b++)g.push(new pan.Layer(a.layers[b].data,a.layers[b].name,a.layers[b].type,a.layers[b].x,a.layers[b].y,a.layers[b].width,a.layers[b].height,a.layers[b].objects));d.tilesets=a.tilesets},attach:function(a,b,c){var d=document.createElement("canvas"),e=pan.canvas;d.setAttribute("id","canvas"),d.setAttribute("width",e.width),d.setAttribute("height",e.height),e.context=d.getContext("2d"),a.appendChild||(a=document.getElementById(a)),a.appendChild(d),b&&(e.onupdate=b),c&&(e.onrender=c)},start:function(){var a=pan.canvas;a.prerender(),pan.util&&pan.util.start(a),a.frameId||a.frame()},stop:function(){pan.canvas.ready=!1},reset:function(){var a=pan.canvas;a.stop(),a.layers=[],a.atlases=[],a.tilesets=[],a.spritesheets=[],a.table=null,a.lights=[],a.hitRegions=[],a.map={tileheight:0,tilewidth:0,width:0,height:0,offsetx:0,offsety:0,clamp:{x:0,y:0,w:0,h:0}},pan.util&&pan.util.reset(a)},frame:function(){var a=pan.canvas;a.ready&&(a.update(),a.render()),a.frameId=window.requestAnimationFrame(a.frame)},update:function(){var a,b,c=pan.canvas,d=c.layers;for(a=0,b=d.length;b>a;a++)d[a].update();c.onupdate&&c.onupdate(c),pan.util&&pan.util.update(c)},prerender:function(){var a,b,c=pan.canvas.layers;for(a=0,b=c.length;b>a;a++)c[a].prerender();pan.canvas.ready=!0},render:function(){var a,b,c,d,e,f,g,h,i,j,k=pan.canvas,l=k.layers,m=k.table,n=pan.canvas.width,o=pan.canvas.height,p=pan.canvas.map.offsetx,q=pan.canvas.map.offsety;for(k.clear(),a=0,c=l.length;c>a;a++)if(e=l[a]||{},"tilelayer"===e.type)for(b=0,d=e.data.length;d>b;b++)f=e.data[b],h=e.coords[b],0!==f&&h&&(g=m[f],i=h.xpos+p,j=h.ypos+q,i+g.w>p&&n>i&&j+g.h>q&&o>j&&k.context.drawImage(k.atlases[g.aindex].image,g.srcx,g.srcy,g.w,g.h,i,j,g.w,g.h));k.onrender&&k.onrender(),pan.util&&pan.util.render(k)},clear:function(){var a=pan.canvas,b=pan.canvas.context;b.fillStyle=a.backcolor,b.fillRect(0,0,a.width,a.height)}},pan.canvas.print=function(a,b,c,d,e){var f=pan.canvas.context;b=b||12,c=c||16,f.font=d||'10pt "Courier New", Courier, monospace',f.fillStyle=e||"cyan",f.fillText(a,b,c)},pan.canvas.drawHitRegions=function(a,b){var c,d,e,f=a||"red",g=b||"rgba(255, 0, 0, 0.1)",h=pan.canvas,i=h.context,j=h.hitRegions,k=h.map;for(i.beginPath(),c=0,d=j.length;d>c;c++)e=j[c],i.rect(e.x+k.offsetx,e.y+k.offsety,e.w,e.h);i.fillStyle=g,i.fill(),i.strokeStyle=f,i.stroke(),i.closePath()}}(),function(){"use strict";pan.util=pan.util||{},pan.util.start=function(a){a.last=Date.now(),(pan.settings.drawFps||pan.settings.debugInit)&&(a.deltaTimer=new pan.util.DeltaTimer,a.deltaTimer.start(60)),(pan.settings.enablePlayer||pan.settings.debugInit)&&(a.player=new pan.util.Player(a.width/2-16,a.height/2-16)),pan.util.keyboard.bind()},pan.util.reset=function(a){a.last=Date.now(),(pan.settings.drawFps||pan.settings.debugInit)&&a.deltaTimer.start(60),(pan.settings.enablePlayer||pan.settings.debugInit)&&(a.player=new pan.util.Player(a.width/2-16,a.height/2-16))},pan.util.update=function(a){pan.settings.enablePlayer&&a.player.update(),pan.settings.drawFps&&a.deltaTimer.ready()},pan.util.render=function(a){var b=pan.settings,c=a.context;b.drawHitRegions&&a.drawHitRegions&&a.drawHitRegions(),b.enablePlayer&&a.player.draw(a.context),b.drawFps&&(c.font=b.fontStyle,c.fillStyle=b.fontColor,c.fillText("FPS: "+a.deltaTimer.getFrameRate(),6,14))},pan.util.DeltaTimer=function(){var a,b=0,c=0,d=0,e=0,f=0,g=100,h=0;return{start:function(b){d=(new Date).getTime(),e=1e3/b,a=(new Date).getTime()},ready:function(){var i=(new Date).getTime()-d+f;return i>=e?(f=i-e,f>g&&(f=0,b=0,a=(new Date).getTime(),h+=1,h>25&&(g+=20,h=0)),d=(new Date).getTime(),b++,b%10===0&&(c=b/(((new Date).getTime()-a)/1e3)),!0):!1},getFrameRate:function(){return Math.round(1e3*c,10)/1e3}}},pan.util.Player=function(a,b,c,d){var e,f,g,h;return a=a||0,b=b||0,c=c||32,d=d||32,g=a,h=b,e="rgba(0, 98, 174, 0.75)",f="rgba(255, 64, 64, 1)",{color:e,bordercolor:f,speed:2,update:function(){var e,f,i,j,k,l,m={x:g,y:h},n=pan.canvas,o=n.map,p=n.hitRegions,q=pan.util.keyboard;if(q.stack.length>0){if(f=q.shift?2*this.speed:this.speed,e=q.peek(),"w"===e?h-=f:"a"===e?g-=f:"s"===e?h+=f:"d"===e&&(g+=f),g===m.x&&h===m.y)return;if(g=g.clamp(0,32*o.width-c),h=h.clamp(0,32*o.height-d),pan.settings.enableHitTesting)for(j=0,k=p.length;k>j;j++)if(l=p[j],this.hitTest(l,g,h,g+c,h+d))return g=m.x,h=m.y,!1;i=o.clamp,g>=i.x&&g<=i.w?(o.offsetx=-(g-i.x),a=i.x):(a=g>=i.x?g-(i.w-i.x):g,a=a.clamp(0,n.width-c)),h>=i.y&&h<=i.h?(o.offsety=-(h-i.y),b=i.y):(b=h>=i.y?h-(i.h-i.y):h,b=b.clamp(0,n.height-d))}},draw:function(e){e.beginPath(),e.rect(a,b,c,d),e.strokeStyle=this.bordercolor,e.stroke(),e.fillStyle=this.color,e.fill(),e.closePath()},hitTest:function(a,b,c,d,e){return a.x<d&&a.x+a.w>b&&a.y<e&&a.y+a.h>c}}},pan.util.keyboard={stack:[],shift:!1,peek:function(){var a=this.stack.pop();return this.stack.push(a),a},keydown:function(a){this.stack.length>0?this.peek()!==a&&this.stack.push(a):this.stack.push(a)},keyup:function(a){this.stack=this.stack.filter(function(b){return b!==a})},clear:function(){this.stack=[],this.shift=!1},bind:function(){var a=pan.util.keyboard;document.onkeydown=function(b){b=b||window.event;var c=b.keyCode;16===c?a.shift=!0:87===c?a.keydown("w"):65===c?a.keydown("a"):83===c?a.keydown("s"):68===c&&a.keydown("d"),pan.settings.logKeyInput&&console.log("keybown.keycode: "+c+"; keyboard: "+a.toString())},document.onkeyup=function(b){b=b||window.event;var c=b.keyCode;16===c?a.shift=!1:87===c?a.keyup("w"):65===c?a.keyup("a"):83===c?a.keyup("s"):68===c&&a.keyup("d"),pan.settings.logKeyInput&&console.log("keyup.keycode: "+c+"; keyboard: "+a.toString())},window.onblur=function(){a.clear()}},toString:function(){return"[stack.length:"+this.stack.length+",shift:"+this.shift+"]"}},Number.prototype.clamp=function(a,b){return Math.min(Math.max(this,a),b)}}();